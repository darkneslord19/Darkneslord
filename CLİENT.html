<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Darknes Lord - Security Terminal v6.0</title>

<style>
:root {
    --bg-dark: #0a0c0f;
    --bg-card: #1a1e24;
    --bg-header: #0f1217;
    --border: #2a2e35;
    --text: #e0e0e0;
    --text-dim: #a0a0a0;
    --accent: #8b0000;
    --accent-hover: #a50000;
    --sus: #ff4444;
    --diff: #ffaa00;
    --safe: #00ff88;
    --gold: #ffd700;
    --gradient: linear-gradient(135deg, #8b0000 0%, #330000 100%);
    --glow: 0 0 20px rgba(139, 0, 0, 0.5);
    --toast-bg: rgba(26, 30, 36, 0.95);
    --key-bg: rgba(10, 12, 15, 0.95);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-dark);
    color: var(--text);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    width: 100%;
    margin: 0;
    padding: 0;
}

/* Matrix Animasyon Arkaplan */
.matrix-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.15;
    pointer-events: none;
}

.matrix-bg::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: repeating-linear-gradient(0deg, 
        transparent, 
        transparent 2px, 
        var(--accent) 2px,
        var(--accent) 3px);
    animation: matrix 20s linear infinite;
    transform-origin: 0 0;
}

@keyframes matrix {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(-50%) rotate(0deg); }
}

/* Key Login Ekranƒ± */
.key-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--key-bg);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.key-box {
    background: var(--bg-card);
    border: 2px solid var(--accent);
    border-radius: 30px;
    padding: 40px;
    width: 90%;
    max-width: 450px;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: var(--glow);
    animation: glowPulse 3s infinite;
}

@keyframes glowPulse {
    0%, 100% { box-shadow: 0 0 30px var(--accent); }
    50% { box-shadow: 0 0 60px var(--accent); }
}

.key-box::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, 
        var(--accent), 
        transparent 40%,
        transparent 60%,
        var(--accent));
    border-radius: 30px;
    z-index: -1;
    animation: borderRotate 4s linear infinite;
}

@keyframes borderRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.key-icon {
    width: 100px;
    height: 100px;
    margin: 0 auto 30px;
    background: var(--gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: white;
    border: 3px solid var(--text);
    box-shadow: var(--glow);
    animation: iconPulse 2s infinite;
}

@keyframes iconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.key-title {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 10px;
    background: linear-gradient(135deg, var(--text), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.key-subtitle {
    color: var(--text-dim);
    font-size: 14px;
    margin-bottom: 30px;
    letter-spacing: 2px;
}

.key-input {
    width: 100%;
    padding: 18px;
    background: var(--bg-dark);
    border: 2px solid var(--border);
    border-radius: 15px;
    color: var(--text);
    font-size: 16px;
    text-align: center;
    letter-spacing: 4px;
    font-family: 'Fira Code', monospace;
    margin-bottom: 20px;
    transition: all 0.3s;
}

.key-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 20px var(--accent);
}

.key-btn {
    width: 100%;
    padding: 18px;
    background: var(--gradient);
    border: none;
    border-radius: 15px;
    color: white;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
    transition: all 0.3s;
}

.key-btn:hover {
    transform: translateY(-3px);
    box-shadow: var(--glow);
}

.key-btn::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
    transform: rotate(45deg);
    animation: btnShine 3s infinite;
}

@keyframes btnShine {
    0% { transform: translateX(-100%) rotate(45deg); }
    100% { transform: translateX(100%) rotate(45deg); }
}

.key-id-box {
    margin-top: 20px;
    padding: 15px;
    background: var(--bg-dark);
    border-radius: 12px;
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.key-id-text {
    font-size: 12px;
    color: var(--text-dim);
    word-break: break-all;
    font-family: monospace;
}

.key-id-btn {
    background: var(--accent);
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s;
    min-width: 60px;
}

.key-id-btn:hover {
    background: var(--accent-hover);
    transform: scale(1.05);
}

.key-status {
    margin-top: 20px;
    padding: 12px;
    border-radius: 10px;
    font-size: 14px;
    display: none;
    align-items: center;
    gap: 8px;
    animation: slideDown 0.3s ease;
}

.key-status.error {
    display: flex;
    background: rgba(255, 68, 68, 0.2);
    border: 1px solid #ff4444;
    color: #ff8888;
}

.key-status.success {
    display: flex;
    background: rgba(0, 255, 136, 0.2);
    border: 1px solid #00ff88;
    color: #88ffaa;
}

.key-status.warning {
    display: flex;
    background: rgba(255, 170, 0, 0.2);
    border: 1px solid #ffaa00;
    color: #ffcc88;
}

.key-status.ban {
    display: flex;
    background: rgba(0, 0, 0, 0.8);
    border: 2px solid #8b0000;
    color: #ff5555;
    font-weight: bold;
}

.key-status.passive {
    display: flex;
    background: rgba(100, 100, 100, 0.3);
    border: 1px solid #666;
    color: #aaa;
}

/* Loading Spinner */
.spinner {
    width: 20px;
    height: 20px;
    border: 3px solid var(--text-dim);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: inline-block;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.hidden {
    display: none !important;
}

/* Ana ƒ∞√ßerik - Tam Ekran */
.main-content {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    opacity: 0;
    transition: opacity 0.5s ease;
    background: transparent;
    overflow: hidden;
    z-index: 1;
}

.main-content.visible {
    opacity: 1;
    z-index: 10;
}

/* ƒ∞√ßerik Konteynƒ±rƒ± */
.content-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-dark);
    overflow: auto;
    display: flex;
    flex-direction: column;
}

/* ƒ∞√ßerik Ba≈ülƒ±k - √áoklu ƒ∞√ßerik i√ßin */
.content-header {
    background: var(--bg-header);
    border-bottom: 2px solid var(--accent);
    padding: 12px 16px;
    display: none; /* Varsayƒ±lan olarak gizli */
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    z-index: 20;
}

.content-header.visible {
    display: flex; /* Sadece √ßoklu i√ßerik varsa g√∂ster */
}

.content-tabs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    flex: 1;
}

.content-tab {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: 30px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
    color: var(--text-dim);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s;
}

.content-tab i {
    font-size: 12px;
    color: var(--accent);
}

.content-tab:hover {
    border-color: var(--accent);
    color: var(--text);
}

.content-tab.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
}

.content-tab.active i {
    color: white;
}

.key-info-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-left: auto;
    font-size: 12px;
    color: var(--text-dim);
}

.key-info-header span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.key-info-header i {
    color: var(--accent);
}

/* ƒ∞√ßerik Alanƒ± - Header yokken tam ekran */
.content-area {
    flex: 1;
    background: var(--bg-dark);
    position: relative;
    overflow: auto;
    height: 100%;
    width: 100%;
}

/* Header varken i√ßerik alanƒ± */
.content-header.visible + .content-area {
    height: calc(100% - 60px);
}

/* Header yokken i√ßerik alanƒ± tam ekran */
.content-area:only-child {
    height: 100%;
}

.content-iframe {
    width: 100%;
    height: 100%;
    border: none;
    background: white;
    display: none;
}

.content-html {
    width: 100%;
    min-height: 100%;
    height: auto;
    background: var(--bg-dark);
    color: var(--text);
    padding: 20px;
    display: none;
    overflow: auto;
    position: relative;
}

/* HTML i√ßerik i√ßin tam ekran d√ºzenleme */
.content-html {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
}

.content-html > * {
    max-width: 100%;
}

/* HTML i√ßerikteki iframe, video vb. i√ßin */
.content-html iframe,
.content-html video,
.content-html img {
    max-width: 100%;
}

/* URL i√ßerik i√ßin otomatik yeni sekme y√∂nlendirme */
.url-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    background: linear-gradient(135deg, #1a1e24 0%, #0f1217 100%);
    padding: 20px;
}

.url-message {
    background: var(--bg-card);
    border: 2px solid var(--accent);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    max-width: 500px;
    box-shadow: var(--glow);
}

.url-message i {
    font-size: 80px;
    color: var(--accent);
    margin-bottom: 20px;
    animation: iconPulse 2s infinite;
}

.url-message h2 {
    color: var(--text);
    margin-bottom: 15px;
    font-size: 24px;
}

.url-message p {
    color: var(--text-dim);
    margin-bottom: 30px;
    word-break: break-all;
    font-family: monospace;
    background: var(--bg-dark);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid var(--border);
}

.url-auto-message {
    color: var(--safe);
    font-size: 14px;
    margin-top: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.url-auto-message i {
    font-size: 16px;
    margin: 0;
    animation: none;
}

/* Mini Toast Bildirimi */
.mini-toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: rgba(10, 12, 15, 0.95);
    border-left: 4px solid var(--accent);
    border-radius: 8px;
    padding: 10px 15px;
    color: var(--text);
    font-size: 12px;
    z-index: 10000;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    animation: slideUp 0.3s ease;
    max-width: 300px;
}

.mini-toast i {
    color: var(--accent);
    font-size: 14px;
}

.mini-toast.warning {
    border-left-color: var(--diff);
}

.mini-toast.warning i {
    color: var(--diff);
}

.mini-toast.danger {
    border-left-color: var(--sus);
}

.mini-toast.danger i {
    color: var(--sus);
}

@keyframes slideUp {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Loading overlay */
.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(10, 12, 15, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    backdrop-filter: blur(5px);
}

.loading-spinner {
    text-align: center;
    color: var(--accent);
}

.loading-spinner i {
    font-size: 60px;
    margin-bottom: 20px;
    animation: spin 1s linear infinite;
}

.loading-spinner p {
    font-size: 18px;
    letter-spacing: 2px;
    margin-top: 10px;
}

.loading-spinner small {
    color: var(--text-dim);
    font-size: 12px;
    margin-top: 10px;
    display: block;
}

/* Responsive */
@media (max-width: 768px) {
    .key-box {
        padding: 30px 20px;
    }
    
    .key-title {
        font-size: 24px;
    }
    
    .mini-toast {
        left: 20px;
        right: 20px;
        max-width: none;
    }
    
    .content-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .key-info-header {
        margin-left: 0;
        width: 100%;
        justify-content: space-between;
    }
    
    .url-message {
        padding: 30px 20px;
    }
    
    .url-message i {
        font-size: 60px;
    }
}
</style>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
<!-- Matrix Arkaplan -->
<div class="matrix-bg"></div>

<!-- KEY LOGIN EKRANI -->
<div id="keyContainer" class="key-container">
    <div class="key-box">
        <div class="key-icon">
            <i class="fas fa-shield-alt"></i>
        </div>
        
        <h1 class="key-title">DARKNES LORD</h1>
        <div class="key-subtitle">SECURITY TERMINAL v6.0</div>
        
        <!-- Cihaz ID G√∂sterimi -->
        <div class="key-id-box">
            <span class="key-id-text" id="deviceId">Cihaz ID y√ºkleniyor...</span>
            <button class="key-id-btn" onclick="copyDeviceId()">
                <i class="fas fa-copy"></i>
            </button>
        </div>
        
        <!-- Key Input -->
        <input type="text" id="keyInput" class="key-input" 
               placeholder="ENTER YOUR KEY" 
               maxlength="50"
               autocomplete="off">
        
        <!-- Giri≈ü Butonu -->
        <button class="key-btn" onclick="verifyKey()" id="verifyBtn">
            <i class="fas fa-key"></i>
            <span>ACCESS TERMINAL</span>
        </button>
        
        <!-- Durum Mesajƒ± -->
        <div id="keyStatus" class="key-status">
            <i class="fas fa-info-circle"></i>
            <span id="statusMessage"></span>
        </div>
        
        <!-- Tarih Bilgisi -->
        <div style="margin-top: 20px; font-size: 11px; color: var(--text-dim);">
            <i class="fas fa-calendar-alt"></i> 
            <span id="currentDate"></span>
        </div>
    </div>
</div>

<!-- ANA ƒ∞√áERƒ∞K -->
<div id="mainContent" class="main-content">
    <div id="contentContainer" class="content-container">
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p id="loadingMessage">ƒ∞√áERƒ∞K Y√úKLENƒ∞YOR...</p>
                <small id="loadingDetail"></small>
            </div>
        </div>
        
        <!-- √áoklu ƒ∞√ßerik Header -->
        <div id="contentHeader" class="content-header">
            <div class="content-tabs" id="contentTabs"></div>
            <div class="key-info-header" id="keyInfoHeader"></div>
        </div>
        
        <!-- ƒ∞√ßerik Alanƒ± -->
        <div id="contentArea" class="content-area">
            <!-- HTML ƒ∞√ßerik - T√ºm i≈ülevler √ßalƒ±≈üsƒ±n -->
            <div id="htmlContent" class="content-html" style="display: none;"></div>
            
            <!-- URL ƒ∞√ßerik i√ßin otomatik yeni sekme a√ßma -->
            <div id="urlContainer" class="content-html" style="display: none;">
                <div class="url-container">
                    <div class="url-message">
                        <i class="fas fa-external-link-alt"></i>
                        <h2>URL ƒ∞√ßerik</h2>
                        <p id="urlDisplay">https://example.com</p>
                        <div class="url-auto-message">
                            <i class="fas fa-spinner fa-pulse"></i>
                            <span>Yeni sekmede otomatik a√ßƒ±lƒ±yor...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mini Toast Bildirim Alanƒ± -->
<div id="miniToast" class="mini-toast" style="display: none;"></div>

<script>
// ========== FIREBASE YAPILANDIRMASI ==========
const FIREBASE_URL = 'https://ghost-19-default-rtdb.firebaseio.com/';

// ========== DEƒûƒ∞≈ûKENLER ==========
let DEVICE_ID = '';
let expiryInterval = null;
let currentKeyData = null;
let lastWarningShown = false;
let currentContentIndex = 0;
let contentArray = [];
let contentType = 'html';
let lastOpenedUrl = ''; // Son a√ßƒ±lan URL'i takip et

// ========== Cƒ∞HAZ ID OLU≈ûTURMA ==========
function generateDeviceId() {
    let navigatorInfo = navigator.userAgent + navigator.language + screen.width + screen.height + screen.colorDepth;
    let canvas = document.createElement('canvas');
    let ctx = canvas.getContext('2d');
    ctx.textBaseline = "top";
    ctx.font = "14px 'Arial'";
    ctx.fillStyle = "#f60";
    ctx.fillRect(125, 1, 62, 20);
    ctx.fillStyle = "#069";
    ctx.fillText("DarknesLord", 2, 15);
    let canvasHash = canvas.toDataURL();
    
    let combined = navigatorInfo + canvasHash;
    let hash = 0;
    for (let i = 0; i < combined.length; i++) {
        hash = ((hash << 5) - hash) + combined.charCodeAt(i);
        hash |= 0;
    }
    return 'DL-' + Math.abs(hash).toString(16).toUpperCase() + '-' + Date.now().toString(36).toUpperCase();
}

// Cihaz ID'sini al veya olu≈ütur
DEVICE_ID = localStorage.getItem('darknes_device_id');
if (!DEVICE_ID) {
    DEVICE_ID = generateDeviceId();
    localStorage.setItem('darknes_device_id', DEVICE_ID);
}
document.getElementById('deviceId').textContent = DEVICE_ID;

// ========== TARƒ∞Hƒ∞ G√ñSTER ==========
function updateDate() {
    let now = new Date();
    let options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
    document.getElementById('currentDate').textContent = now.toLocaleDateString('tr-TR', options);
}
updateDate();
setInterval(updateDate, 60000);

// ========== Cƒ∞HAZ ID KOPYALA ==========
function copyDeviceId() {
    navigator.clipboard.writeText(DEVICE_ID);
    let btn = event.target.closest('button');
    let originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-check"></i>';
    setTimeout(() => {
        btn.innerHTML = originalHTML;
    }, 1000);
    showKeyStatus('Cihaz ID kopyalandƒ±!', 'success');
}

// ========== KEY DURUM MESAJI ==========
function showKeyStatus(message, type = 'error') {
    let statusDiv = document.getElementById('keyStatus');
    let messageSpan = document.getElementById('statusMessage');
    
    statusDiv.className = 'key-status ' + type;
    messageSpan.textContent = message;
    statusDiv.style.display = 'flex';
    
    // 5 saniye sonra otomatik gizle
    setTimeout(() => {
        statusDiv.style.display = 'none';
    }, 5000);
}

// ========== Mƒ∞Nƒ∞ TOAST G√ñSTER ==========
function showMiniToast(message, type = 'info', duration = 3000) {
    let toast = document.getElementById('miniToast');
    
    let icon = 'info-circle';
    if (type === 'warning') icon = 'exclamation-triangle';
    if (type === 'danger') icon = 'exclamation-circle';
    if (type === 'success') icon = 'check-circle';
    
    toast.className = 'mini-toast ' + type;
    toast.innerHTML = `<i class="fas fa-${icon}"></i> <span>${message}</span>`;
    toast.style.display = 'flex';
    
    setTimeout(() => {
        toast.style.display = 'none';
    }, duration);
}

// ========== LOADING MESAJI G√úNCELLE ==========
function updateLoadingMessage(message, detail = '') {
    document.getElementById('loadingMessage').textContent = message;
    document.getElementById('loadingDetail').textContent = detail;
}

// ========== Gƒ∞Rƒ∞≈û EKRANINI G√ñSTER ==========
function returnToLogin() {
    // Interval'i temizle
    if (expiryInterval) {
        clearInterval(expiryInterval);
        expiryInterval = null;
    }
    
    // Mini toast'u gizle
    document.getElementById('miniToast').style.display = 'none';
    
    // Ana sayfaya d√∂n
    showLoginScreen();
}

function showLoginScreen() {
    document.getElementById('keyContainer').style.display = 'flex';
    document.getElementById('mainContent').classList.remove('visible');
    document.getElementById('keyInput').value = '';
    document.getElementById('verifyBtn').disabled = false;
    document.getElementById('verifyBtn').innerHTML = '<i class="fas fa-key"></i><span>ACCESS TERMINAL</span>';
    
    // LocalStorage temizliƒüi
    localStorage.removeItem('darknes_auth');
    localStorage.removeItem('darknes_key');
    localStorage.removeItem('darknes_expiry');
    localStorage.removeItem('darknes_content_type');
    localStorage.removeItem('darknes_content_array');
    localStorage.removeItem('darknes_selected_index');
}

// ========== ARKA PLANDA S√úRE TAKƒ∞Bƒ∞ ==========
function startBackgroundExpiryTracking(expiryTime, keyCode) {
    // Eski interval'i temizle
    if (expiryInterval) {
        clearInterval(expiryInterval);
    }
    
    lastWarningShown = false;
    
    // Yeni interval ba≈ülat (arka planda √ßalƒ±≈üƒ±r)
    expiryInterval = setInterval(() => {
        let now = Date.now();
        let remaining = expiryTime - now;
        
        if (remaining <= 0) {
            // S√ºre doldu - sessizce √ßƒ±kƒ±≈ü yap
            clearInterval(expiryInterval);
            expiryInterval = null;
            
            // Kullanƒ±cƒ±ya kƒ±sa bir bildirim g√∂ster
            showMiniToast('Key s√ºreniz doldu! Ana sayfaya y√∂nlendiriliyorsunuz...', 'danger', 3000);
            
            // 3 saniye sonra login ekranƒ±na d√∂n
            setTimeout(() => {
                returnToLogin();
            }, 3000);
            
            return;
        }
        
        // Sadece kritik durumlarda bildirim g√∂ster
        if (remaining < 300000 && !lastWarningShown) { // 5 dakikadan az
            let minutes = Math.floor(remaining / 60000);
            showMiniToast(`‚ö†Ô∏è Key s√ºreniz ${minutes} dakika kaldƒ±!`, 'warning', 5000);
            lastWarningShown = true;
        }
        
        // Her 5 dakikada bir Firebase'den g√ºncel durumu kontrol et
        if (Math.floor(now / 300000) !== Math.floor((now - 1000) / 300000)) {
            checkKeyStatusFromFirebase(keyCode);
        }
        
    }, 1000); // Her saniye kontrol et (arka planda)
}

// ========== FIREBASE'DEN KEY DURUMUNU KONTROL ET ==========
async function checkKeyStatusFromFirebase(keyCode) {
    try {
        let response = await fetch(FIREBASE_URL + 'keys.json');
        let data = await response.json();
        
        for (let [id, keyData] of Object.entries(data)) {
            if (keyData.key === keyCode) {
                // Ban kontrol√º
                if (keyData.status === 'banned') {
                    showMiniToast('‚ùå KEY BANLANDI! √áƒ±kƒ±≈ü yapƒ±lƒ±yor...', 'danger', 4000);
                    setTimeout(() => {
                        returnToLogin();
                    }, 2000);
                    return;
                }
                
                // Pasif kontrol√º
                if (keyData.status === 'passive') {
                    showMiniToast('‚ö†Ô∏è KEY PASƒ∞F DURUMA ALINDI!', 'warning', 4000);
                    setTimeout(() => {
                        returnToLogin();
                    }, 2000);
                    return;
                }
                
                // S√ºre g√ºncellemesi
                if (keyData.expiry && keyData.expiry !== currentKeyData?.expiry) {
                    // S√ºre deƒüi≈ümi≈ü, interval'i g√ºncelle
                    clearInterval(expiryInterval);
                    startBackgroundExpiryTracking(keyData.expiry, keyCode);
                    
                    // Yeni s√ºreyi localStorage'a kaydet
                    localStorage.setItem('darknes_expiry', keyData.expiry);
                    
                    // Kullanƒ±cƒ±ya bildir
                    let newExpiryDate = new Date(keyData.expiry).toLocaleString('tr-TR');
                    showMiniToast(`‚úÖ Key s√ºreniz g√ºncellendi: ${newExpiryDate}`, 'success', 4000);
                }
                
                currentKeyData = keyData;
                break;
            }
        }
    } catch (error) {
        console.error('Firebase kontrol hatasƒ±:', error);
    }
}

// ========== URL'ƒ∞ YENƒ∞ SEKMEde A√á ==========
function openUrlInNewTab(url) {
    // Aynƒ± URL tekrar a√ßƒ±lmasƒ±n
    if (lastOpenedUrl === url) {
        return;
    }
    
    lastOpenedUrl = url;
    
    // URL'i d√ºzenle
    if (!url.startsWith('http')) {
        url = 'https://' + url;
    }
    
    // Yeni sekmede a√ß
    window.open(url, '_blank', 'noopener,noreferrer');
    
    // Mini toast g√∂ster
    showMiniToast(`URL yeni sekmede a√ßƒ±ldƒ±: ${url}`, 'success', 2000);
}

// ========== √áOKLU ƒ∞√áERƒ∞K G√ñSTER ==========
function renderMultiContent(keyData) {
    let header = document.getElementById('contentHeader');
    let tabs = document.getElementById('contentTabs');
    let htmlDiv = document.getElementById('htmlContent');
    let urlContainer = document.getElementById('urlContainer');
    let keyInfo = document.getElementById('keyInfoHeader');
    
    // Son a√ßƒ±lan URL'i sƒ±fƒ±rla
    lastOpenedUrl = '';
    
    // ƒ∞√ßerik tipini belirle
    contentType = keyData.contentType || 'html';
    
    // ƒ∞√ßerik dizisini al
    if (contentType === 'html') {
        contentArray = keyData.htmlContents || ['<h3 style="color: var(--accent); text-align: center; margin-top: 50px;">ƒ∞√ßerik bulunamadƒ±</h3>'];
        currentContentIndex = keyData.selectedHtmlIndex || 0;
    } else {
        contentArray = keyData.urlContents || ['https://example.com'];
        currentContentIndex = keyData.selectedUrlIndex || 0;
    }
    
    // ƒ∞√ßerik sayƒ±sƒ±nƒ± kontrol et - header'ƒ± sadece √ßoklu i√ßerik varsa g√∂ster
    let validContents = contentArray.filter(c => c && c.trim() !== '');
    
    // Admin panelde se√ßilen i√ßerik sayƒ±sƒ±na g√∂re header'ƒ± g√∂ster/gizle
    if (validContents.length > 1) {
        // √áoklu i√ßerik - header g√∂r√ºns√ºn
        header.classList.add('visible');
        
        // Sekmeleri olu≈ütur
        let tabsHtml = '';
        validContents.forEach((content, index) => {
            let icon = contentType === 'html' ? 'fa-code' : 'fa-link';
            let isActive = index === currentContentIndex ? 'active' : '';
            tabsHtml += `
                <div class="content-tab ${isActive}" onclick="switchContent(${index})">
                    <i class="fas ${icon}"></i>
                    ƒ∞√ßerik ${index + 1}
                </div>
            `;
        });
        tabs.innerHTML = tabsHtml;
        
    } else {
        // Tek i√ßerik - header gizli kalsƒ±n
        header.classList.remove('visible');
        // Sekmeleri temizle
        tabs.innerHTML = '';
    }
    
    // Key bilgilerini header'a ekle
    let expiryText = keyData.expiry ? new Date(keyData.expiry).toLocaleString('tr-TR') : 'S√ºresiz';
    let statusText = keyData.status === 'active' ? '‚úÖ Aktif' : (keyData.status === 'passive' ? '‚è∏Ô∏è Pasif' : 'üö´ Banlƒ±');
    
    // Cihaz bilgilerini g√∂ster
    let devices = keyData.devices || [];
    let limit = keyData.limit ? parseInt(keyData.limit) : 1;
    let deviceText = `üì± ${devices.length}/${limit}`;
    
    keyInfo.innerHTML = `
        <span><i class="fas fa-clock"></i> ${expiryText}</span>
        <span><i class="fas fa-tag"></i> ${statusText}</span>
        <span><i class="fas fa-mobile-alt"></i> ${deviceText}</span>
    `;
    
    // ƒ∞lk i√ßeriƒüi g√∂ster
    switchContent(currentContentIndex);
}

// ========== ƒ∞√áERƒ∞K DEƒûƒ∞≈ûTƒ∞R ==========
function switchContent(index) {
    currentContentIndex = index;
    
    // Sekme aktifliƒüini g√ºncelle (sadece header g√∂r√ºn√ºrse)
    if (document.getElementById('contentHeader').classList.contains('visible')) {
        document.querySelectorAll('.content-tab').forEach((tab, i) => {
            if (i === index) {
                tab.classList.add('active');
            } else {
                tab.classList.remove('active');
            }
        });
    }
    
    // ƒ∞√ßeriƒüi g√∂ster
    let content = contentArray[index];
    let htmlDiv = document.getElementById('htmlContent');
    let urlContainer = document.getElementById('urlContainer');
    
    if (contentType === 'html') {
        // HTML i√ßerik g√∂ster
        htmlDiv.style.display = 'block';
        urlContainer.style.display = 'none';
        
        // HTML i√ßeriƒüi doƒürudan innerHTML ile ekle
        htmlDiv.innerHTML = content;
        
        // HTML i√ßerikteki script'lerin √ßalƒ±≈ümasƒ± i√ßin
        const scripts = htmlDiv.getElementsByTagName('script');
        for (let i = 0; i < scripts.length; i++) {
            const script = document.createElement('script');
            if (scripts[i].src) {
                script.src = scripts[i].src;
            } else {
                script.textContent = scripts[i].textContent;
            }
            document.body.appendChild(script).parentNode.removeChild(script);
        }
        
    } else {
        // URL i√ßerik g√∂ster - otomatik yeni sekmede a√ß
        htmlDiv.style.display = 'none';
        urlContainer.style.display = 'block';
        
        let url = content;
        if (!url.startsWith('http')) {
            url = 'https://' + url;
        }
        
        // URL'i g√∂ster
        document.getElementById('urlDisplay').textContent = url;
        
        // URL'i otomatik yeni sekmede a√ß
        setTimeout(() => {
            openUrlInNewTab(url);
        }, 100);
    }
    
    showMiniToast(`ƒ∞√ßerik ${index + 1} g√∂steriliyor`, 'success', 1500);
}

// ========== KEY DOƒûRULAMA ==========
async function verifyKey() {
    let keyInput = document.getElementById('keyInput');
    let key = keyInput.value.trim();
    let verifyBtn = document.getElementById('verifyBtn');
    
    if (!key) {
        showKeyStatus('L√ºtfen bir key girin!', 'error');
        return;
    }
    
    // Butonu disable et
    verifyBtn.disabled = true;
    let originalBtnText = verifyBtn.innerHTML;
    verifyBtn.innerHTML = '<span class="spinner"></span> DOƒûRULANIYOR...';
    
    try {
        // Firebase'den verileri √ßek
        let response = await fetch(FIREBASE_URL + 'keys.json', {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error('Firebase baƒülantƒ± hatasƒ±: ' + response.status);
        }
        
        let data = await response.json();
        
        if (!data) {
            throw new Error('Firebase verisi bo≈ü');
        }
        
        // Key kontrol√º
        let validKey = null;
        let keyId = null;
        let currentTime = Date.now();
        
        // T√ºm keyleri dola≈ü
        for (let [id, keyData] of Object.entries(data)) {
            if (keyData.key && keyData.key.trim().toUpperCase() === key.trim().toUpperCase()) {
                validKey = keyData;
                keyId = id;
                break;
            }
        }
        
        if (!validKey) {
            throw new Error('Ge√ßersiz key!');
        }
        
        // Status kontrol√º
        if (validKey.status === 'banned') {
            throw { type: 'ban', message: '‚ùå BU KEY BANLANMI≈ûTIR!' };
        }
        
        if (validKey.status === 'passive') {
            throw { type: 'passive', message: '‚ö†Ô∏è KEY PASƒ∞F DURUMDA!' };
        }
        
        // S√ºre kontrol√º
        if (validKey.expiry && currentTime > validKey.expiry) {
            throw new Error('Key s√ºresi dolmu≈ü!');
        }
        
        // ========== Cƒ∞HAZ Lƒ∞Mƒ∞T KONTROL√ú ==========
        // Mevcut cihaz listesini al (yoksa bo≈ü array olu≈ütur)
        let devices = validKey.devices || [];
        let deviceLimit = validKey.limit ? parseInt(validKey.limit) : 1;
        
        console.log('Cihaz kontrol√º:', {
            devices: devices,
            deviceLimit: deviceLimit,
            currentDevice: DEVICE_ID,
            deviceExists: devices.includes(DEVICE_ID)
        });
        
        // Bu cihaz daha √∂nce kayƒ±tlƒ± mƒ± kontrol et
        let deviceExists = devices.includes(DEVICE_ID);
        
        if (!deviceExists) {
            // Yeni cihaz, limit kontrol√º yap
            if (devices.length >= deviceLimit) {
                // Limit a≈üƒ±ldƒ±
                let errorMsg = `‚ùå Cihaz limiti a≈üƒ±ldƒ±! (Maksimum: ${deviceLimit} cihaz)`;
                if (deviceLimit === 1) {
                    errorMsg = '‚ùå Bu key sadece TEK cihazda kullanƒ±labilir! Ba≈üka bir cihazda kullanƒ±lƒ±yor.';
                }
                throw new Error(errorMsg);
            }
            
            // Yeni cihazƒ± listeye ekle
            devices.push(DEVICE_ID);
            
            // Firebase'i g√ºncelle - devices array'ini g√∂nder
            console.log('Yeni cihaz ekleniyor:', devices);
            
            let updateResult = await fetch(`${FIREBASE_URL}keys/${keyId}.json`, {
                method: 'PATCH',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    devices: devices,
                    lastLogin: currentTime
                })
            });
            
            if (!updateResult.ok) {
                console.warn('Cihaz listesi g√ºncellenemedi:', await updateResult.text());
            } else {
                showMiniToast(`‚úÖ Yeni cihaz kaydedildi (${devices.length}/${deviceLimit})`, 'success', 3000);
            }
        } else {
            // Mevcut cihaz, sadece son giri≈ü zamanƒ±nƒ± g√ºncelle
            console.log('Mevcut cihaz, son giri≈ü g√ºncelleniyor');
            
            await fetch(`${FIREBASE_URL}keys/${keyId}.json`, {
                method: 'PATCH',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    lastLogin: currentTime
                })
            }).catch(e => console.warn('Son giri≈ü g√ºncellenemedi'));
        }
        
        showKeyStatus('‚úì Key doƒürulandƒ±!', 'success');
        
        // Key verisini g√ºncelle (cihaz listesi dahil)
        validKey.devices = devices;
        currentKeyData = validKey;
        
        // √áoklu i√ßerikleri localStorage'a kaydet
        localStorage.setItem('darknes_auth', 'true');
        localStorage.setItem('darknes_key', key);
        localStorage.setItem('darknes_expiry', validKey.expiry || '');
        localStorage.setItem('darknes_content_type', validKey.contentType || 'html');
        localStorage.setItem('darknes_content_array', JSON.stringify(validKey.htmlContents || validKey.urlContents || []));
        localStorage.setItem('darknes_selected_index', String(validKey.selectedHtmlIndex || validKey.selectedUrlIndex || 0));
        
        // Ana i√ßeriƒüi g√∂ster
        setTimeout(() => {
            document.getElementById('keyContainer').style.display = 'none';
            document.getElementById('mainContent').classList.add('visible');
            
            // √áoklu i√ßeriƒüi render et
            renderMultiContent(validKey);
            
            // S√ºre takibini ba≈ülat
            if (validKey.expiry) {
                startBackgroundExpiryTracking(validKey.expiry, validKey.key);
            }
            
        }, 1000);
        
    } catch (error) {
        console.error('Login error:', error);
        
        if (error.type === 'ban') {
            showKeyStatus(error.message, 'ban');
        } else if (error.type === 'passive') {
            showKeyStatus(error.message, 'passive');
        } else {
            showKeyStatus(error.message, 'error');
        }
        
        verifyBtn.disabled = false;
        verifyBtn.innerHTML = originalBtnText;
    }
}

// ========== OTOMATƒ∞K Gƒ∞Rƒ∞≈û KONTROL√ú ==========
async function checkAutoLogin() {
    let isAuth = localStorage.getItem('darknes_auth');
    let expiry = localStorage.getItem('darknes_expiry');
    let contentType = localStorage.getItem('darknes_content_type');
    let contentArrayStr = localStorage.getItem('darknes_content_array');
    let selectedIndex = localStorage.getItem('darknes_selected_index');
    let key = localStorage.getItem('darknes_key');
    
    if (isAuth === 'true' && contentArrayStr && key) {
        // S√ºre kontrol√º
        if (expiry && Date.now() > parseInt(expiry)) {
            showLoginScreen();
            showKeyStatus('KEY S√úRESƒ∞ DOLDU!', 'error');
            return;
        }
        
        try {
            // Firebase'den g√ºncel verileri kontrol et
            let response = await fetch(FIREBASE_URL + 'keys.json');
            let data = await response.json();
            
            let keyValid = false;
            let keyData = null;
            
            for (let [id, kd] of Object.entries(data)) {
                if (kd.key === key) {
                    keyData = kd;
                    
                    // Status kontrol√º
                    if (kd.status === 'banned') {
                        showLoginScreen();
                        showKeyStatus('KEY BANLANMI≈û!', 'ban');
                        return;
                    }
                    if (kd.status === 'passive') {
                        showLoginScreen();
                        showKeyStatus('KEY PASƒ∞F DURUMDA!', 'passive');
                        return;
                    }
                    if (kd.expiry && Date.now() > kd.expiry) {
                        showLoginScreen();
                        showKeyStatus('KEY S√úRESƒ∞ DOLMU≈û!', 'error');
                        return;
                    }
                    
                    // Cihaz kontrol√º - bu cihaz listede var mƒ±?
                    let devices = kd.devices || [];
                    console.log('Otomatik giri≈ü cihaz kontrol√º:', {
                        devices: devices,
                        currentDevice: DEVICE_ID,
                        exists: devices.includes(DEVICE_ID)
                    });
                    
                    if (!devices.includes(DEVICE_ID)) {
                        // Cihaz listede yok, otomatik giri≈ü yapma
                        showLoginScreen();
                        showKeyStatus('Bu cihaz yetkili deƒüil!', 'error');
                        return;
                    }
                    
                    keyValid = true;
                    currentKeyData = kd;
                    break;
                }
            }
            
            if (keyValid) {
                // Otomatik giri≈ü
                document.getElementById('keyContainer').style.display = 'none';
                document.getElementById('mainContent').classList.add('visible');
                
                // √áoklu i√ßeriƒüi render et
                renderMultiContent(keyData);
                
                // S√ºre takibini ba≈ülat
                if (keyData.expiry) {
                    startBackgroundExpiryTracking(keyData.expiry, keyData.key);
                }
            } else {
                showLoginScreen();
            }
            
        } catch (error) {
            console.error('Otomatik giri≈ü hatasƒ±:', error);
            // Firebase'e baƒülanamazsa local'deki verilerle devam et
            
            let localContentArray = JSON.parse(contentArrayStr || '[]');
            let localSelectedIndex = parseInt(selectedIndex || '0');
            
            // Local data ile devam et
            document.getElementById('keyContainer').style.display = 'none';
            document.getElementById('mainContent').classList.add('visible');
            
            // Son a√ßƒ±lan URL'i sƒ±fƒ±rla
            lastOpenedUrl = '';
            
            // ƒ∞√ßerik tipine g√∂re ayarla
            if (contentType === 'html') {
                contentArray = localContentArray;
                currentContentIndex = localSelectedIndex;
                
                // ƒ∞√ßerik sayƒ±sƒ±nƒ± kontrol et
                let validContents = contentArray.filter(c => c && c.trim() !== '');
                if (validContents.length > 1) {
                    document.getElementById('contentHeader').classList.add('visible');
                    
                    // Sekmeleri olu≈ütur
                    let tabsHtml = '';
                    validContents.forEach((content, index) => {
                        let isActive = index === currentContentIndex ? 'active' : '';
                        tabsHtml += `
                            <div class="content-tab ${isActive}" onclick="switchContent(${index})">
                                <i class="fas fa-code"></i>
                                ƒ∞√ßerik ${index + 1}
                            </div>
                        `;
                    });
                    document.getElementById('contentTabs').innerHTML = tabsHtml;
                } else {
                    document.getElementById('contentHeader').classList.remove('visible');
                    document.getElementById('contentTabs').innerHTML = '';
                }
                
                // ƒ∞√ßeriƒüi g√∂ster
                document.getElementById('htmlContent').style.display = 'block';
                document.getElementById('urlContainer').style.display = 'none';
                document.getElementById('htmlContent').innerHTML = contentArray[currentContentIndex];
            } else {
                // URL i√ßerik i√ßin
                contentArray = localContentArray;
                currentContentIndex = localSelectedIndex;
                
                // ƒ∞√ßerik sayƒ±sƒ±nƒ± kontrol et
                let validContents = contentArray.filter(c => c && c.trim() !== '');
                if (validContents.length > 1) {
                    document.getElementById('contentHeader').classList.add('visible');
                    
                    // Sekmeleri olu≈ütur
                    let tabsHtml = '';
                    validContents.forEach((content, index) => {
                        let isActive = index === currentContentIndex ? 'active' : '';
                        tabsHtml += `
                            <div class="content-tab ${isActive}" onclick="switchContent(${index})">
                                <i class="fas fa-link"></i>
                                ƒ∞√ßerik ${index + 1}
                            </div>
                        `;
                    });
                    document.getElementById('contentTabs').innerHTML = tabsHtml;
                } else {
                    document.getElementById('contentHeader').classList.remove('visible');
                    document.getElementById('contentTabs').innerHTML = '';
                }
                
                // URL'i g√∂ster ve otomatik a√ß
                let url = contentArray[currentContentIndex];
                if (!url.startsWith('http')) {
                    url = 'https://' + url;
                }
                
                document.getElementById('htmlContent').style.display = 'none';
                document.getElementById('urlContainer').style.display = 'block';
                document.getElementById('urlDisplay').textContent = url;
                
                // Otomatik a√ß
                setTimeout(() => {
                    openUrlInNewTab(url);
                }, 100);
            }
            
            // S√ºre takibini ba≈ülat
            if (expiry) {
                startBackgroundExpiryTracking(parseInt(expiry), key);
            }
        }
    }
}

// ========== PERƒ∞YODƒ∞K KONTROL ==========
setInterval(async () => {
    if (document.getElementById('mainContent').classList.contains('visible')) {
        let expiry = localStorage.getItem('darknes_expiry');
        let key = localStorage.getItem('darknes_key');
        
        if (expiry && Date.now() > parseInt(expiry)) {
            returnToLogin();
        } else if (key) {
            // Her 5 dakikada bir Firebase'den g√ºncel durumu kontrol et
            checkKeyStatusFromFirebase(key);
        }
    }
}, 300000); // 5 dakikada bir kontrol

// ========== SAYFA Y√úKLENƒ∞NCE ==========
window.onload = function() {
    checkAutoLogin();
};

// ========== KEYBOARD KISAYOLLARI ==========
document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && document.getElementById('keyContainer').style.display !== 'none') {
        verifyKey();
    }
});

// ========== SAYFA G√ñR√úN√úRL√úƒû√ú DEƒûƒ∞≈ûƒ∞NCE ==========
document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
        // Sayfa arka plandayken interval devam eder
        console.log('Sayfa arka planda, s√ºre takibi devam ediyor');
    } else {
        // Sayfa tekrar g√∂r√ºn√ºr olduƒüunda g√ºncel durumu kontrol et
        let key = localStorage.getItem('darknes_key');
        if (key) {
            checkKeyStatusFromFirebase(key);
        }
    }
});

console.log('Sistem ba≈ülatƒ±ldƒ±. Firebase URL:', FIREBASE_URL);
console.log('Cihaz ID:', DEVICE_ID);
</script>
</body>
</html>
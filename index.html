<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Smali Regex Enjekt√∂r ¬∑ onCreate tespit</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #0b1525;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, Helvetica, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 12px 10px;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .phone-card {
            width: 100%;
            max-width: 520px;
            background: #11223a;
            border-radius: 36px 36px 28px 28px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(80, 140, 240, 0.2) inset;
            overflow: hidden;
            border: 1px solid #2a4070;
        }

        .header {
            background: #0f1b30;
            padding: 24px 18px 16px 18px;
            border-bottom: 1px solid #2f4b78;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            background: linear-gradient(145deg, #c0e0ff, #9bc0ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .header h1 span {
            font-size: 1.2rem;
            background: #1f3450;
            padding: 6px 14px;
            border-radius: 50px;
            border: 1px solid #3e6bb0;
            color: #b8d6ff;
            font-weight: 500;
        }

        .sub {
            color: #a5c0dd;
            font-size: 0.95rem;
            padding: 6px 12px;
            background: #1e2f4a70;
            border-radius: 40px;
            display: inline-block;
            border-left: 3px solid #4f8ad4;
        }

        .content {
            padding: 18px 16px 22px 16px;
            display: flex;
            flex-direction: column;
            gap: 22px;
        }

        .section {
            background: #0e1a2b;
            border-radius: 28px;
            padding: 18px 14px;
            border: 1px solid #253e62;
            box-shadow: 0 6px 10px #00000040;
        }

        .section-title {
            color: #c6dcff;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px dashed #365a88;
            padding-bottom: 8px;
        }

        .section-title i {
            font-style: normal;
            font-size: 1.4rem;
        }

        .file-row {
            display: flex;
            align-items: center;
            background: #1c2f48;
            border-radius: 60px;
            border: 1px solid #34588a;
            margin-bottom: 16px;
            min-height: 56px;
        }

        .file-btn {
            background: #264c7a;
            border: none;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            padding: 14px 22px;
            border-radius: 60px;
            cursor: pointer;
            flex-shrink: 0;
            border: 1px solid #6392d0;
            letter-spacing: 0.3px;
            transition: 0.1s;
            box-shadow: 0 4px 6px black;
        }

        .file-btn:active {
            background: #1e3f64;
            transform: scale(0.97);
        }

        .file-name {
            flex: 1;
            padding: 0 16px;
            color: #b5d0f0;
            font-size: 0.9rem;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .chip-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0 10px;
        }

        .chip {
            background: #1d3450;
            border: 1px solid #3f6190;
            color: #c6dcff;
            padding: 8px 16px;
            border-radius: 40px;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .chip-success {
            background: #1d4a3a;
            border-color: #319f6d;
            color: #d0f0d0;
        }

        .chip-warn {
            background: #4f3a1c;
            border-color: #c09a40;
            color: #ffdfa0;
        }

        .preview-box {
            background: #030c18;
            border-radius: 24px;
            padding: 14px;
            border: 1px solid #2d4980;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            color: #d3e3ff;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            margin: 10px 0 8px;
            box-shadow: inset 0 0 10px #00000070;
        }

        .regex-box {
            background: #14273f;
            border-radius: 18px;
            padding: 12px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #ffd966;
            border: 1px solid #4f7cb0;
            margin-bottom: 12px;
            word-break: break-all;
        }

        .regex-box span {
            color: #a5d0ff;
            font-family: inherit;
        }

        .mobile-textarea {
            width: 100%;
            background: #030f1f;
            border: 1px solid #345f9b;
            border-radius: 26px;
            padding: 18px 16px;
            color: #e0f0ff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            min-height: 150px;
            resize: vertical;
            outline: none;
            margin: 6px 0 12px;
            box-shadow: 0 0 0 1px #25487a inset;
        }

        .info-note {
            background: #14273f;
            padding: 14px 16px;
            border-radius: 22px;
            color: #bfd6ff;
            font-size: 0.9rem;
            border-left: 5px solid #3a7bcb;
            margin: 10px 0 5px;
        }

        .info-note i {
            font-style: normal;
            background: #1e3b60;
            padding: 3px 10px;
            border-radius: 30px;
            color: #fee5a8;
        }

        .action-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 12px 0 6px;
        }

        .action-btn {
            flex: 1 1 120px;
            background: #1d3452;
            border: 1px solid #416ba3;
            color: #e1efff;
            padding: 16px 8px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1rem;
            text-align: center;
            cursor: pointer;
            transition: 0.1s;
            box-shadow: 0 5px 0 #0b1625;
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .action-btn:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #0b1625;
            background: #264573;
        }

        .btn-primary {
            background: #0f3d7a;
            border-color: #6d9ef0;
            box-shadow: 0 5px 0 #08203b;
        }

        .btn-success {
            background: #1f6d4a;
            border-color: #4dbf8f;
        }

        .message {
            background: #2f384b;
            border-radius: 60px;
            padding: 14px 20px;
            color: #e4f0ff;
            font-weight: 500;
            font-size: 0.95rem;
            display: none;
            align-items: center;
            gap: 8px;
            border: 1px solid #5d82b0;
            margin-top: 16px;
        }

        .message.error {
            background: #622b2b;
            border-color: #c97a7a;
        }

        .message.success {
            background: #1b553b;
            border-color: #53c28b;
        }

        .footer {
            text-align: center;
            padding: 18px 12px 14px;
            color: #5f7aa8;
            font-size: 0.8rem;
            border-top: 1px solid #1e3452;
        }
    </style>
</head>
<body>
<div class="phone-card">
    <div class="header">
        <h1>
            ‚òï SmaliCE
            <span>regex+</span>
        </h1>
        <div class="sub">onCreate enjekt√∂r ¬∑ anlƒ±k tespit</div>
    </div>

    <div class="content">
        <!-- Regex bilgi paneli -->
        <div class="regex-box">
            <span>üîç MATCH:</span> .method (.+) onCreate\(Landroid/os/Bundle;\)V\n    \.registers (\d+)<br>
            <span>üìç REPLACE:</span> .method ${GROUP1} onCreate(Landroid/os/Bundle;)V\n    .registers ${GROUP2}\n\n       [ENJEKTE KOD]
        </div>

        <!-- 1. Smali y√ºkleme - ANLIK TESPƒ∞T √ñZELLƒ∞KLƒ∞ -->
        <div class="section">
            <div class="section-title"><i>üìÅ</i> 1. Smali dosyasƒ±</div>
            <div class="file-row">
                <button class="file-btn" id="mobileFileBtn">Dosya se√ß</button>
                <div class="file-name" id="mobileFileName">MainActivity.smali</div>
                <input type="file" id="mobileFileInput" accept=".smali" style="display: none;">
            </div>
            
            <!-- CANLI TESPƒ∞T ETƒ∞KETLERƒ∞ - ye≈üil ‚úÖ ile -->
            <div class="chip-group">
                <span class="chip" id="onCreateChip">‚è≥ taranƒ±yor...</span>
                <span class="chip" id="registersChip">üî¢ registers: ?</span>
                <span class="chip" id="methodLineChip">üìç metod: ?</span>
            </div>
            
            <!-- Metod √∂nizleme -->
            <div style="font-size:0.9rem; color:#9bb5de; margin-bottom:4px;">üìÑ onCreate metodu (tespit edilen)</div>
            <div class="preview-box" id="mobilePreview">Dosya y√ºkleyin veya √∂rnek kullanƒ±n</div>
            
            <!-- Eƒüer onCreate yoksa burada uyarƒ± g√∂sterilecek -->
            <div id="onCreateWarning" style="display: none; background: #4f3a1c; border-radius: 18px; padding: 10px; color: #ffdfa0; margin-top: 8px; text-align: center;">
                ‚ö†Ô∏è UYARI: Dosyada onCreate metodu bulunamadƒ±!
            </div>
        </div>

        <!-- 2. Enjekte edilecek kod -->
        <div class="section">
            <div class="section-title"><i>üíâ</i> 2. Enjeksiyon kodu</div>
            <textarea class="mobile-textarea" id="mobileInjectCode" placeholder="; Buraya yazacaƒüƒ±nƒ±z kod, .registers satƒ±rƒ±ndan SONRA eklenecek">const-string v0, "‚úÖ REGEX INJECT"
invoke-static {v0, v0}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I
</textarea>
            <div class="info-note">
                üí° <i>.registers</i> deƒüeri korunur, sizin kodunuz hemen altƒ±na eklenir.
            </div>
        </div>

        <!-- 3. √áƒ±ktƒ± -->
        <div class="section">
            <div class="section-title"><i>‚öôÔ∏è</i> 3. Enjekte edilmi≈ü metod</div>
            <div class="chip-group">
                <span class="chip" id="statsMobile">üìä registers korundu</span>
                <span class="chip" id="lineCount">üìè ? satƒ±r</span>
            </div>
            <div class="preview-box" id="mobileOutput" style="max-height: 220px;">Enjekle butonuna basƒ±n</div>

            <div class="action-grid">
                <button class="action-btn btn-primary" id="mobileInjectBtn">üî® Regex Enjekle</button>
                <button class="action-btn" id="mobileCopyBtn">üìã Kopyala</button>
                <button class="action-btn btn-success" id="mobileDownloadBtn">‚¨áÔ∏è ƒ∞ndir</button>
            </div>
        </div>

        <div class="message" id="mobileMessage"></div>
    </div>

    <div class="footer">
        ‚ö†Ô∏è Regex e≈üle≈ümesi: .method + onCreate + .registers ¬∑ Anlƒ±k tespit ye≈üil ‚úÖ etiketiyle
    </div>
</div>

<script>
    (function() {
        const fileBtn = document.getElementById('mobileFileBtn');
        const fileInput = document.getElementById('mobileFileInput');
        const fileNameDiv = document.getElementById('mobileFileName');
        const onCreateChip = document.getElementById('onCreateChip');
        const registersChip = document.getElementById('registersChip');
        const methodLineChip = document.getElementById('methodLineChip');
        const mobilePreview = document.getElementById('mobilePreview');
        const injectCode = document.getElementById('mobileInjectCode');
        const outputPre = document.getElementById('mobileOutput');
        const injectBtn = document.getElementById('mobileInjectBtn');
        const copyBtn = document.getElementById('mobileCopyBtn');
        const downloadBtn = document.getElementById('mobileDownloadBtn');
        const statsMobile = document.getElementById('statsMobile');
        const lineCountSpan = document.getElementById('lineCount');
        const messageDiv = document.getElementById('mobileMessage');
        const onCreateWarning = document.getElementById('onCreateWarning');

        // State - regex e≈üle≈üme sonu√ßlarƒ±nƒ± tut
        let currentSmali = '';
        let onCreateMethodLine = '';      // .method ... onCreate satƒ±rƒ±
        let registersLine = '';            // .registers N satƒ±rƒ±
        let registersValue = 0;
        let methodAccessModifier = '';     // public, protected vb.
        let onCreateStartLineIndex = -1;
        let registersLineIndex = -1;
        let methodEndLineIndex = -1;

        // √ñrnek smali (tam regex e≈üle≈ümesi i√ßin)
        const dummySmali = `.class public Lcom/example/MainActivity;
.super Landroidx/appcompat/app/AppCompatActivity;

.method protected onCreate(Landroid/os/Bundle;)V
    .registers 3
    invoke-super {p0, p1}, Landroidx/appcompat/app/AppCompatActivity;->onCreate(Landroid/os/Bundle;)V
    const v0, 0x7f0b001c
    invoke-virtual {p0, v0}, Lcom/example/MainActivity;->setContentView(I)V
    return-void
.end method

.method public onResume()V
    .registers 1
    return-void
.end method`;

        // ƒ∞lk y√ºkleme
        function loadDummy() {
            parseWithRegex(dummySmali);
            fileNameDiv.innerText = 'MainActivity.smali';
        }
        loadDummy();

        fileBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            fileNameDiv.innerText = file.name;
            const reader = new FileReader();
            reader.onload = (ev) => parseWithRegex(ev.target.result);
            reader.readAsText(file);
        });

        // Regex ile tam e≈üle≈üme - GELƒ∞≈ûTƒ∞Rƒ∞LMƒ∞≈û TESPƒ∞T
        function parseWithRegex(fullText) {
            currentSmali = fullText;
            const lines = fullText.split(/\r?\n/);
            
            // Regex: .method (.*) onCreate\(Landroid/os/Bundle;\)V
            // ardƒ±ndan bir sonraki satƒ±rda .registers (\d+)
            let found = false;
            
            // √ñnce t√ºm satƒ±rlarƒ± g√∂ster (debug)
            console.log('Dosya satƒ±r sayƒ±sƒ±:', lines.length);
            
            for (let i = 0; i < lines.length - 1; i++) {
                const currentLine = lines[i].trim();
                // Daha esnek regex: .method ile ba≈ülayan ve onCreate i√ßeren
                if (currentLine.includes('.method') && currentLine.includes('onCreate') && currentLine.includes('Landroid/os/Bundle;')) {
                    // .method satƒ±rƒ± bulundu, sonraki satƒ±r .registers mƒ±?
                    const nextLine = lines[i + 1].trim();
                    if (nextLine.startsWith('.registers') || nextLine.startsWith('.locals')) {
                        // .registers veya .locals olabilir
                        const registersMatch = nextLine.match(/^\.(?:registers|locals)\s+(\d+)$/);
                        if (registersMatch) {
                            found = true;
                            onCreateStartLineIndex = i;
                            registersLineIndex = i + 1;
                            
                            // Access modifier'ƒ± ayƒ±kla (protected, public vs)
                            const methodMatch = currentLine.match(/^\.method\s+(.+)\s+onCreate\(/);
                            if (methodMatch) {
                                methodAccessModifier = methodMatch[1];
                            } else {
                                methodAccessModifier = "unknown";
                            }
                            
                            registersValue = parseInt(registersMatch[1], 10);
                            onCreateMethodLine = lines[i];
                            registersLine = lines[i + 1];
                            
                            // .end method bul
                            for (let j = i + 2; j < lines.length; j++) {
                                if (lines[j].trim() === '.end method') {
                                    methodEndLineIndex = j;
                                    break;
                                }
                            }
                            break;
                        }
                    }
                }
            }

            // Tespit sonu√ßlarƒ±na g√∂re etiketleri g√ºncelle
            if (!found) {
                // onCreate YOK - kƒ±rmƒ±zƒ± etiket ve uyarƒ± g√∂ster
                onCreateChip.innerHTML = '‚ùå onCreate YOK';
                onCreateChip.style.background = '#622b2b';
                onCreateChip.style.borderColor = '#c97a7a';
                onCreateChip.style.color = '#ffc0c0';
                
                registersChip.innerHTML = 'üî¢ -';
                methodLineChip.innerHTML = 'üìç bulunamadƒ±';
                
                // Uyarƒ± mesajƒ±nƒ± g√∂ster
                onCreateWarning.style.display = 'block';
                
                // Preview'da dosyanƒ±n ba≈üƒ±nƒ± g√∂ster
                mobilePreview.innerText = lines.slice(0, 8).join('\n') + '\n...\n‚ö†Ô∏è onCreate metodu bulunamadƒ±!';
                
                // Output'u temizle
                outputPre.innerText = '// onCreate metodu bulunamadƒ±\n// Dosyada .method ... onCreate(Landroid/os/Bundle;)V\n// ve ardƒ±ndan .registers satƒ±rƒ± aranƒ±yor.';
                
                showMsg('onCreate metodu bulunamadƒ±!', 'error');
                return;
            }

            // onCreate VAR - ye≈üil etiket g√∂ster
            onCreateChip.innerHTML = '‚úÖ onCreate VAR';
            onCreateChip.style.background = '#1d4a3a';
            onCreateChip.style.borderColor = '#319f6d';
            onCreateChip.style.color = '#d0f0d0';
            
            registersChip.innerHTML = `üî¢ registers: ${registersValue}`;
            methodLineChip.innerHTML = `üìç ${methodAccessModifier}`;
            
            // Uyarƒ± mesajƒ±nƒ± gizle
            onCreateWarning.style.display = 'none';
            
            // onCreate metodunun tamamƒ±nƒ± preview'da g√∂ster
            const endIdx = methodEndLineIndex !== -1 ? methodEndLineIndex : lines.length - 1;
            const methodLines = lines.slice(onCreateStartLineIndex, endIdx + 1);
            mobilePreview.innerText = methodLines.join('\n');
            
            // Output'u g√ºncelle
            updateOutput(injectCode.value);
            
            showMsg('‚úÖ onCreate ba≈üarƒ±yla tespit edildi!', 'success');
        }

        // Enjeksiyon: .registers satƒ±rƒ±ndan sonra ekle
        function injectWithRegex(injectText) {
            if (onCreateStartLineIndex === -1 || registersLineIndex === -1 || methodEndLineIndex === -1) {
                showMsg('√ñnce ge√ßerli bir smali y√ºkleyin', 'error');
                return null;
            }

            const lines = currentSmali.split(/\r?\n/);
            
            // Enjeksiyon yapƒ±lacak satƒ±rlar: .registers satƒ±rƒ±ndan sonra, metodun geri kalanƒ±ndan √∂nce
            const beforeRegisters = lines.slice(0, registersLineIndex + 1); // .registers dahil
            const afterRegisters = lines.slice(registersLineIndex + 1, methodEndLineIndex); // .registers sonrasƒ± .end method'a kadar
            const endMethodLine = lines[methodEndLineIndex];
            const afterMethod = lines.slice(methodEndLineIndex + 1);

            // Inject satƒ±rlarƒ±nƒ± hazƒ±rla (her satƒ±rƒ±n ba≈üƒ±nda 4 bo≈üluk olmalƒ±)
            let injectLines = injectText.split(/\r?\n/).filter(l => l.trim() !== '');
            if (injectLines.length === 0) {
                injectLines = ['# bo≈ü enjeksiyon'];
            }
            
            // Satƒ±rlarƒ±n ba≈üƒ±na 4 bo≈üluk ekle (eƒüer yoksa)
            const formattedInject = injectLines.map(l => {
                if (l.startsWith('    ')) return l;
                return '    ' + l;
            });

            // Yeni metod: beforeRegisters + formattedInject + afterRegisters + endMethodLine
            const newMethodLines = [
                ...beforeRegisters,
                ...formattedInject,
                ...afterRegisters,
                endMethodLine
            ];

            // T√ºm dosyayƒ± yeniden olu≈ütur (sadece onCreate deƒüi≈üti)
            const newSmali = [
                ...lines.slice(0, onCreateStartLineIndex),
                ...newMethodLines,
                ...afterMethod
            ].join('\n');

            // ƒ∞statistik
            statsMobile.innerText = `üìä registers ${registersValue} (korundu)`;
            lineCountSpan.innerText = `üìè ${newMethodLines.length} satƒ±r`;

            // Sadece onCreate metodunu d√∂nd√ºr (output i√ßin)
            return newMethodLines.join('\n');
        }

        function updateOutput(injectCodeText) {
            const injected = injectWithRegex(injectCodeText);
            if (injected) {
                outputPre.innerText = injected;
            }
        }

        // Enjekle butonu
        injectBtn.addEventListener('click', () => {
            if (onCreateStartLineIndex === -1) {
                showMsg('√ñnce onCreate i√ßeren bir smali y√ºkleyin!', 'error');
                return;
            }
            const code = injectCode.value;
            const res = injectWithRegex(code);
            if (res) {
                outputPre.innerText = res;
                showMsg('‚úÖ Enjeksiyon tamam! .registers sonrasƒ±na eklendi', 'success');
            }
        });

        // Kopyala
        copyBtn.addEventListener('click', async () => {
            const text = outputPre.innerText;
            if (!text || text.includes('bulunamadƒ±')) {
                showMsg('Kopyalanacak i√ßerik yok', 'error');
                return;
            }
            try {
                await navigator.clipboard.writeText(text);
                showMsg('üìã Kopyalandƒ±', 'success');
            } catch {
                showMsg('Kopyalama ba≈üarƒ±sƒ±z', 'error');
            }
        });

        // ƒ∞ndir
        downloadBtn.addEventListener('click', () => {
            if (!currentSmali || onCreateStartLineIndex === -1) {
                showMsg('Ge√ßerli smali yok', 'error');
                return;
            }
            
            const newOnCreate = outputPre.innerText;
            if (!newOnCreate || newOnCreate.includes('bulunamadƒ±')) {
                showMsg('√ñnce ba≈üarƒ±lƒ± bir enjeksiyon yapƒ±n', 'warning');
                return;
            }

            // T√ºm dosyayƒ± yeniden olu≈ütur
            const lines = currentSmali.split(/\r?\n/);
            
            // Enjekte edilmi≈ü onCreate satƒ±rlarƒ±nƒ± al
            const newOnCreateLines = newOnCreate.split(/\r?\n/);
            
            // Dosyayƒ± birle≈ütir
            const updatedSmali = [
                ...lines.slice(0, onCreateStartLineIndex),
                ...newOnCreateLines,
                ...lines.slice(methodEndLineIndex + 1)
            ].join('\n');

            const blob = new Blob([updatedSmali], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileNameDiv.innerText.replace(/\.smali$/,'') + '_injected.smali';
            a.click();
            URL.revokeObjectURL(url);
            showMsg('üìÅ ƒ∞ndirildi', 'success');
        });

        function showMsg(text, type = 'info') {
            messageDiv.style.display = 'flex';
            messageDiv.innerText = 'üîî ' + text;
            messageDiv.className = 'message';
            if (type === 'error') messageDiv.classList.add('error');
            else if (type === 'success') messageDiv.classList.add('success');
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
    })();
</script>
</body>
</html>
